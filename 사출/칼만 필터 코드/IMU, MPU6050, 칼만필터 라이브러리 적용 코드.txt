IMU, MPU6050, 칼만필터 라이브러리 적용 코드

#include <Wire.h>
#include <MPU6050.h>
#include <Kalman.h>

MPU6050 mpu;
Kalman kalmanX;
Kalman kalmanY;

float gyroXangle, gyroYangle; // 각도 추정을 위한 변수
float kalAngleX, kalAngleY; // 칼만 필터 적용 각도
uint32_t timer;

void setup() {
  Serial.begin(115200);
  Wire.begin();
  mpu.initialize();
  timer = micros();
}

void loop() {
  // 센서에서 데이터 읽기
  mpu.update();
  
  float accX = mpu.getAccX();
  float accY = mpu.getAccY();
  float accZ = mpu.getAccZ();
  float gyroX = mpu.getGyroX();
  float gyroY = mpu.getGyroY();

  float accAngleX = (atan2(accY, accZ) + PI) * RAD_TO_DEG;
  float accAngleY = (atan2(accX, accZ) + PI) * RAD_TO_DEG;

  float dt = (micros() - timer) / 1000000.0; // 시간차 계산
  timer = micros();

  // 자이로스코프 데이터를 각도로 변환
  gyroXangle += gyroX * dt;
  gyroYangle += gyroY * dt;

  // 칼만 필터로 각도 추정
  kalAngleX = kalmanX.getAngle(accAngleX, gyroX, dt);
  kalAngleY = kalmanY.getAngle(accAngleY, gyroY, dt);

  // 값 출력
  Serial.print("Kalman Angle X: ");
  Serial.print(kalAngleX);
  Serial.print(" | Kalman Angle Y: ");
  Serial.println(kalAngleY);

  delay(50);
}